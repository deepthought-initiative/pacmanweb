# Backend Installation

Start off by cloning the GitHub repo-
```bash
git clone git@github.com:deepthought-initiative/pacmanweb.git
```
or by using https
```bash
git clone https://github.com/deepthought-initiative/pacmanweb.git
```

The PACMan directory needs to be placed next to the PACManWeb directory. Clone the PACMan repo in the same folder. The bash `ls` should say that both repos are next to each other. PACManWeb supports uploading files as well, so no need to run PACMan before moving on to the application.


#### Install Conda Environments
Head over to the PACManWeb directory. This environment installation has been done using Mamba and tested on Linux and Mac. Installing might work using Conda, but Mamba is recommended. To install mamba, head over too the [mamba installation page](https://mamba.readthedocs.io/en/latest/installation/mamba-installation.html).
```bash
mamba env create --file env.yml --name pacmanweb
```
Instructions to install the PACMan environment are listed here- https://github.com/spacetelescope/PACMan?tab=readme-ov-file#installation.


#### Config Variables
PACManWeb needs access to a `secrets.json` file to work, this needs to be present in the root of the PACManWeb repository.
The `secrets.json` file will be like this-
```json
{
    "secret_key": "",
    "default_password":"",
    "ADS_DEV_KEY": "",
    "ENV_NAME":""
}
``` 
The secret key is a hash and can be generated by 

```bash
python -c 'import secrets; print(secrets.token_hex())'
```

The default password is your default password to use for the application. PACManWeb uses Basic Auth for secure transmission of files and execution of the application. `ADS_DEV_KEY` is the key that PACMan would use to access the ADS Database. `ENV_NAME` contains the name of the conda environment.


#### Setting up Celery
PACMan web implements task queues in Celery to run PACMan tasks one by one. Celery requires Redis and backend and RabbitMQ as a message broker to run.
- Redis installation instructions can be found on the redis website- https://redis.io/docs/install/install-redis/.
- Redis can also be installed like so-
```bash
docker run -d --name redis-stack -p 6379:6379 -p 8001:8001 redis/redis-stack:latest
```
- RabbitMQ instructions can be found here- https://www.rabbitmq.com/download.html. Once installed, RabbitMQ will need to be setup with these commands- https://docs.celeryq.dev/en/stable/getting-started/backends-and-brokers/rabbitmq.html#setting-up-rabbitmq.

Once Redis and RabbitMQ are setup, you can start running celery. 
```none
celery -A pacmanweb.celery_app worker --loglevel=info
```

#### Starting Flask Application
To start Flask in developement mode-
```bash
flask run
```